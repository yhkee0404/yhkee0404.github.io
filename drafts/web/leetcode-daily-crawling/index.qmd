---
title: "LeetCode Daily Crawling"
subtitle: "Excel에서 GraphQL 요청하기"
author: "Yunho Kee"
date: "2024-03-17"
categories:
  - featured
  - web
  - crawling
  - leetcode
  - graphql
image: "화면 캡처 2024-03-16 235413.jpg"
---

## Intro

{{< video https://youtu.be/yjD2n_e9E3w >}}

Crawling App도 Excel로 대체할 수 있을까?

## Goodbye LeetCode Click

::: {layout="[[1], [1]]"}
![LeetCode Click 서비스 중단](화면 캡처 2024-03-16 235413.jpg){group="" fig-alt="A screenshot of the discontinuation of the LeetCode click service."}

![매일 리트코드를 풀던 카카오톡 오픈채팅방 반응 캡처](KakaoTalk_Snapshot_20240316_233937.png){group="" fig-alt="A captured conversation of people frustrated by the discontinuation of the LeetCode click service."}
:::

연말에 들어간 알고리즘 스터디에서 매일 리트코드 1문제를 풀었는데 [LeetCode Click](https://leetcode.click)에 접속하면 그날의 새로운 문제로 Redirect되었다. 그런데 열흘 전부터 서비스가 중단돼 대안이 필요해졌다.

## LeetCode Daily Question

![LeetCode Daily Question 확인 방법](화면 캡처 2024-03-17 003045.jpg){group="" fig-alt="A screenshot displaying today's question in the problem list and the daily questions for each day on the calendar on the LeetCode website."}

좌측 하단의 문제 목록 맨 위에 그날의 문제가 보인다. 그날의 문제만 `Status`에 달력 아이콘이 보인다. 그리고 연결된 주소에 `daily-question` 같은 Parameter가 붙는다. 한편 오른쪽 달력에도 마우스 커서를 Hover하면 날짜마다 다른 문제가 Popup 된다. 이것이 육안으로 확인하고 수동 접속하는 방법이다.

## LeetCode GraphQL API

오늘의 문제만 특정하는 원리를 이용해 보려고 개발자 도구를 열었는데 검색이 안 된다. 그래서 요청 목록 중 의심되는 `graphql/` 중 하나를 Click하니 `Preview` 또는 `Response` Tab에 다음처럼 쓸 만한 응답이 보인다.

```json
{
    "data": {
        "activeDailyCodingChallengeQuestion": {
            "date": "2024-03-16",
            "userStatus": "NotStart",
            "link": "/problems/contiguous-array/",
            "question": {
                "acRate": 47.945016299587756,
                "difficulty": "Medium",
                "freqBar": null,
                "frontendQuestionId": "525",
                "isFavor": false,
                "paidOnly": false,
                "status": null,
                "title": "Contiguous Array",
                "titleSlug": "contiguous-array",
                "hasVideoSolution": false,
                "hasSolution": true,
                "topicTags": [
                    {
                        "name": "Array",
                        "id": "VG9waWNUYWdOb2RlOjU=",
                        "slug": "array"
                    },
                    {
                        "name": "Hash Table",
                        "id": "VG9waWNUYWdOb2RlOjY=",
                        "slug": "hash-table"
                    },
                    {
                        "name": "Prefix Sum",
                        "id": "VG9waWNUYWdOb2RlOjYxMDY4",
                        "slug": "prefix-sum"
                    }
                ]
            }
        }
    }
}
```

:::{.callout-note}
GraphQL 응답은 Chrome 개발자 도구의 `Network` Tab에서 검색이 안 되는 게 기본이라 일일이 클릭해 확인해야 한다 &mdash; 혹시 검색 방법을 아시면 댓글 부탁 드려요!
:::

사실 이렇게 발견한 것은 아니다. 다른 GraphQL 요청에서 `dailyCodingChallengeV2`를 먼저 보고 GitHub에 검색해서 찾았다. 즉 다른 데서 겨우 찾은 건데 나중에 알고 보니 여기에도 원래 있었다 &mdash; Discord에서는 [elprimobot](https://github.com/kajahno/elprimobot/blob/857cd02d8e34fd360ad908cb00edc2e1708e7250/api/leetcode/queries.js#L22) 유용해 보이네요!

![Chrome 개발자 도구로 확인한 GraphQL 요청의 Payload](화면 캡처 2024-03-17 015135.jpg){group="" fig-alt="A screenshot of a GraphQL request's payload from Chrome DevTools."}

이대로 Terminal에서 cURL해도 잘 된다. 실험 결과 `operationName`과 `variables`은 불필요했고, 일부 불필요한 항목도 지울 수 있었다.

## Try HTTP `GET` as well as `POST`

Request Method를 POST로 했는데 GET도 될까? Request Body의 Payload를 Query String으로 바꾸고 싶은데 띄어쓰기나 특수문자는 어떻게 바꾸나?

```javascript
new URLSearchParams({"query": "query questionOfToday {\n  activeDailyCodingChallengeQuestion {\n    date\n    link\n    question {\n      acRate\n      difficulty\n      frontendQuestionId: questionFrontendId\n      title\n      titleSlug\n    }\n  }\n}"}).toString()
// 'query=query+questionOfToday+%7B%0A++activeDailyCodingChallengeQuestion+%7B%0A++++date%0A++++link%0A++++question+%7B%0A++++++acRate%0A++++++difficulty%0A++++++frontendQuestionId%3A+questionFrontendId%0A++++++title%0A++++++titleSlug%0A++++%7D%0A++%7D%0A%7D'
```

여기서 연속된 +만 하나로 줄였다.

## Google Sheets As a Crawling App

아쉽게도 응답받은 Link는 LeetCode 도메인이 없어서 브라우저의 주소 창에 도메인과 함께 붙여넣어야 한다. 카카오톡 오픈채팅봇은 이런 기능이 자유롭지 않은 것 같고, 기존 같은 One-click 서비스는 Redirect할 Server가 필요하다. 다행히 우리 스터디가 사용하는 Google Sheets가 GET 요청, 문자열 연산, Hyperlink 기능을 지원한다: `IMPORTDATA`, `CONCATENATE`, `MID`, `LEN`.

```scala
=IMPORTDATA("https://leetcode.com/graphql?query=query+questionOfToday+%7B+activeDailyCodingChallengeQuestion+%7B+link+%7D+%7D")
=CONCATENATE("https://leetcode.com", MID(D1, 56, LEN(D1) - 59))
```

![Google Sheets에서 Parsing한 GraphQL JSON 응답](화면 캡처 2024-03-17 031317.jpg){group="" fig-alt="A screenshot displaying a hyperlink parsed from a JSON response to a GraphQL request within Google Sheets."}

한 칸으로 줄이지 못한 이유는 `MID` 함수와 `LEN` 함수를 둘다 호출하느라 `IMPORTDATA`의 중복 요청을 방지하기 위해서이다 &mdash; 혹시 중복 없는 한 칸 방법을 아신다면 댓글로 남겨 주세요!

## Limitations

GraphQL API에서 GET 이외의 Method나 Header, Payload (Request Body)을 요구하면 `IMPORTDATA`는 쓸 수 없을 것이다. `IMPORTDATA`는  Query String